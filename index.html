
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cadastro e Sorteio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .winner-animation {
            animation: bounce 1s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-800 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">üé≤ Sistema de Sorteio</h1>
            <p class="text-blue-100">Cadastre-se e participe do sorteio!</p>
            
            <!-- Status de Conex√£o Firebase -->
            <div id="connectionStatus" class="mt-4 inline-flex items-center px-4 py-2 rounded-full text-sm font-medium">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                <span>Conectando ao Firebase...</span>
            </div>
            
            <!-- Bot√£o de Teste -->
            <div class="mt-4">
                <button 
                    id="testConnectionBtn"
                    class="bg-white bg-opacity-20 text-white px-6 py-2 rounded-lg hover:bg-opacity-30 transition-all duration-200 text-sm font-medium"
                >
                    üß™ Testar Conex√£o
                </button>
            </div>
        </div>

        <div class="max-w-6xl mx-auto grid md:grid-cols-2 gap-8">
            <!-- Formul√°rio de Cadastro -->
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    üìù Cadastro
                </h2>
                
                <form id="cadastroForm" class="space-y-6">
                    <div>
                        <label for="userId" class="block text-sm font-medium text-gray-700 mb-2">
                            ID do Participante
                        </label>
                        <input 
                            type="number" 
                            id="userId" 
                            name="userId"
                            required
                            min="1"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                            placeholder="Digite um ID √∫nico (ex: 001, 123, 456)"
                        >
                    </div>
                    
                    <div>
                        <label for="userName" class="block text-sm font-medium text-gray-700 mb-2">
                            Nome Completo
                        </label>
                        <input 
                            type="text" 
                            id="userName" 
                            name="userName"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                            placeholder="Digite seu nome completo"
                        >
                    </div>
                    
                    <button 
                        type="submit"
                        class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-purple-700 hover:to-blue-700 transform hover:scale-105 transition-all duration-200 shadow-lg"
                    >
                        ‚ú® Cadastrar Participante
                    </button>
                </form>

                <!-- Status do Cadastro -->
                <div id="statusMessage" class="mt-4 p-4 rounded-lg hidden"></div>
            </div>

            <!-- Painel de Controle -->
            <div id="adminPanel" class="bg-white rounded-2xl shadow-2xl p-8 hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    üéØ Painel de Sorteio
                </h2>
                
                <div class="space-y-6">
                    <!-- Contador de Participantes -->
                    <div class="bg-gradient-to-r from-green-100 to-blue-100 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-700 font-medium">Total de Participantes:</span>
                            <span id="totalParticipants" class="text-2xl font-bold text-green-600">0</span>
                        </div>
                    </div>
                    
                    <!-- Bot√£o de Sorteio -->
                    <button 
                        id="sortearBtn"
                        disabled
                        class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold py-4 px-6 rounded-lg hover:from-orange-600 hover:to-red-600 transform hover:scale-105 transition-all duration-200 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                    >
                        üé≤ Realizar Sorteio
                    </button>
                    
                    <!-- Resultado do Sorteio -->
                    <div id="sorteioResult" class="hidden">
                        <div class="bg-gradient-to-r from-yellow-100 to-orange-100 p-6 rounded-lg border-2 border-yellow-300">
                            <h3 class="text-lg font-bold text-gray-800 mb-3 text-center">üèÜ Participante Sorteado!</h3>
                            <div id="winnerInfo" class="text-center winner-animation">
                                <!-- Resultado aparecer√° aqui -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de Participantes (s√≥ para admin) -->
        <div id="participantsSection" class="max-w-6xl mx-auto mt-8 hidden">
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    üë• Participantes Cadastrados
                </h2>
                
                <div id="participantsList" class="space-y-3">
                    <p class="text-gray-500 text-center py-8">Nenhum participante cadastrado ainda.</p>
                </div>
                
                <!-- Bot√£o para Limpar Lista (s√≥ aparece para admin) -->
                <div id="clearListSection" class="mt-6 text-center">
                    <button 
                        id="clearListBtn"
                        class="bg-red-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-red-600 transition-colors duration-200"
                    >
                        üóëÔ∏è Limpar Lista
                    </button>
                </div>
            </div>
        </div>

        <!-- Bot√£o de Acesso Administrativo (Discreto) -->
        <div class="max-w-6xl mx-auto mt-4 text-center">
            <button 
                id="adminAccessBtn"
                class="text-xs text-gray-400 hover:text-gray-600 transition-colors duration-200 bg-transparent border-none cursor-pointer"
                title="Acesso administrativo"
            >
                ‚öôÔ∏è
            </button>
        </div>

        <!-- Modal de Login Administrativo -->
        <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
                <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">üîê Acesso Administrativo</h3>
                
                <form id="loginForm">
                    <div class="mb-6">
                        <label for="adminPassword" class="block text-sm font-medium text-gray-700 mb-2">
                            Senha de Administrador
                        </label>
                        <input 
                            type="password" 
                            id="adminPassword" 
                            name="adminPassword"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                            placeholder="Digite a senha"
                        >
                    </div>
                    
                    <div class="flex space-x-4">
                        <button 
                            type="button"
                            id="cancelLoginBtn"
                            class="flex-1 bg-gray-300 text-gray-700 font-semibold py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors duration-200"
                        >
                            Cancelar
                        </button>
                        <button 
                            type="submit"
                            class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all duration-200"
                        >
                            Entrar
                        </button>
                    </div>
                </form>
                
                <div id="loginError" class="mt-4 p-3 bg-red-100 text-red-700 rounded-lg hidden text-center">
                    Senha incorreta! Tente novamente.
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDjiI2t8VOh4ee7AsHWboFF_k4bhlkqABs",
            authDomain: "serversorte.firebaseapp.com",
            databaseURL: "https://serversorte-default-rtdb.firebaseio.com",
            projectId: "serversorte",
            storageBucket: "serversorte.firebasestorage.app",
            messagingSenderId: "17401961353",
            appId: "1:17401961353:web:0b5bc0bf1ad738e480df58"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // Banco de dados Firebase
        let participants = [];
        
        // Configura√ß√£o de seguran√ßa
        const ADMIN_PASSWORD = 'admin123'; // Altere esta senha para sua prefer√™ncia
        let isAdminLoggedIn = false;
        
        // Elementos do DOM
        const form = document.getElementById('cadastroForm');
        const statusMessage = document.getElementById('statusMessage');
        const totalParticipants = document.getElementById('totalParticipants');
        const sortearBtn = document.getElementById('sortearBtn');
        const sorteioResult = document.getElementById('sorteioResult');
        const winnerInfo = document.getElementById('winnerInfo');
        const participantsList = document.getElementById('participantsList');
        const clearListBtn = document.getElementById('clearListBtn');
        const clearListSection = document.getElementById('clearListSection');
        const adminPanel = document.getElementById('adminPanel');
        const participantsSection = document.getElementById('participantsSection');
        const adminAccessBtn = document.getElementById('adminAccessBtn');
        const loginModal = document.getElementById('loginModal');
        const loginForm = document.getElementById('loginForm');
        const cancelLoginBtn = document.getElementById('cancelLoginBtn');
        const loginError = document.getElementById('loginError');
        
        // Inicializar Firebase e carregar dados
        const participantsRef = ref(database, 'participants');
        
        // Teste de conex√£o Firebase
        const connectionStatus = document.getElementById('connectionStatus');
        
        // Escutar mudan√ßas em tempo real
        onValue(participantsRef, (snapshot) => {
            // Atualizar status de conex√£o
            connectionStatus.innerHTML = `
                <div class="w-3 h-3 bg-green-400 rounded-full mr-2 animate-pulse"></div>
                <span class="text-green-100">üî• Firebase Conectado!</span>
            `;
            connectionStatus.className = 'mt-4 inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-green-500 bg-opacity-20';
            
            participants = [];
            if (snapshot.exists()) {
                const data = snapshot.val();
                Object.keys(data).forEach(key => {
                    participants.push({
                        firebaseKey: key,
                        id: data[key].id,
                        name: data[key].name,
                        timestamp: data[key].timestamp
                    });
                });
            }
            updateDisplay();
        }, (error) => {
            // Erro de conex√£o
            console.error('Erro de conex√£o Firebase:', error);
            connectionStatus.innerHTML = `
                <div class="w-3 h-3 bg-red-400 rounded-full mr-2"></div>
                <span class="text-red-100">‚ùå Erro de Conex√£o</span>
            `;
            connectionStatus.className = 'mt-4 inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-red-500 bg-opacity-20';
        });
        
        // Inicializar a p√°gina
        updateDisplay();
        
        // Bot√£o de teste de conex√£o
        const testConnectionBtn = document.getElementById('testConnectionBtn');
        testConnectionBtn.addEventListener('click', async function() {
            const originalText = testConnectionBtn.textContent;
            testConnectionBtn.textContent = '‚è≥ Testando...';
            testConnectionBtn.disabled = true;
            
            try {
                // Criar um teste tempor√°rio
                const testRef = ref(database, 'connection_test');
                const testData = {
                    timestamp: new Date().toISOString(),
                    test: 'Firebase connection test'
                };
                
                await set(testRef, testData);
                
                // Remover o teste
                await remove(testRef);
                
                // Mostrar sucesso
                connectionStatus.innerHTML = `
                    <div class="w-3 h-3 bg-green-400 rounded-full mr-2 animate-pulse"></div>
                    <span class="text-green-100">‚úÖ Teste Realizado com Sucesso!</span>
                `;
                connectionStatus.className = 'mt-4 inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-green-500 bg-opacity-20';
                
                alert('üéâ Conex√£o Firebase funcionando perfeitamente!\n\n‚úÖ Escrita: OK\n‚úÖ Leitura: OK\n‚úÖ Remo√ß√£o: OK');
                
            } catch (error) {
                console.error('Erro no teste:', error);
                connectionStatus.innerHTML = `
                    <div class="w-3 h-3 bg-red-400 rounded-full mr-2"></div>
                    <span class="text-red-100">‚ùå Falha no Teste</span>
                `;
                connectionStatus.className = 'mt-4 inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-red-500 bg-opacity-20';
                
                alert('‚ùå Erro na conex√£o Firebase:\n\n' + error.message);
            }
            
            testConnectionBtn.textContent = originalText;
            testConnectionBtn.disabled = false;
        });
        
        // Sistema de login administrativo
        adminAccessBtn.addEventListener('click', function() {
            loginModal.classList.remove('hidden');
            document.getElementById('adminPassword').focus();
        });
        
        cancelLoginBtn.addEventListener('click', function() {
            loginModal.classList.add('hidden');
            loginForm.reset();
            loginError.classList.add('hidden');
        });
        
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                loginModal.classList.add('hidden');
                adminPanel.classList.remove('hidden');
                participantsSection.classList.remove('hidden');
                loginForm.reset();
                loginError.classList.add('hidden');
                updateDisplay();
                
                // Adicionar bot√£o de logout
                if (!document.getElementById('logoutBtn')) {
                    const logoutBtn = document.createElement('button');
                    logoutBtn.id = 'logoutBtn';
                    logoutBtn.innerHTML = 'üö™ Sair do Painel';
                    logoutBtn.className = 'fixed top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors duration-200 text-sm z-40';
                    logoutBtn.addEventListener('click', logout);
                    document.body.appendChild(logoutBtn);
                }
            } else {
                loginError.classList.remove('hidden');
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        });
        
        function logout() {
            isAdminLoggedIn = false;
            adminPanel.classList.add('hidden');
            participantsSection.classList.add('hidden');
            sorteioResult.classList.add('hidden');
            
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.remove();
            }
        }
        
        // Fechar modal ao clicar fora
        loginModal.addEventListener('click', function(e) {
            if (e.target === loginModal) {
                cancelLoginBtn.click();
            }
        });
        
        // Cadastro de participante
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const userId = document.getElementById('userId').value.trim();
            const userName = document.getElementById('userName').value.trim();
            
            // Verificar se o ID j√° existe
            if (participants.some(p => p.id === userId)) {
                showMessage('‚ùå Este ID j√° est√° cadastrado! Use um ID diferente.', 'error');
                return;
            }
            
            try {
                // Mostrar loading
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = '‚è≥ Cadastrando...';
                submitBtn.disabled = true;
                
                // Adicionar participante no Firebase
                const newParticipant = {
                    id: userId,
                    name: userName,
                    timestamp: new Date().toLocaleString('pt-BR')
                };
                
                await push(participantsRef, newParticipant);
                
                // Limpar formul√°rio
                form.reset();
                
                // Mostrar mensagem de sucesso
                showMessage(`‚úÖ ${userName} foi cadastrado com sucesso!`, 'success');
                
                // Restaurar bot√£o
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                
            } catch (error) {
                console.error('Erro ao cadastrar:', error);
                showMessage('‚ùå Erro ao cadastrar participante. Tente novamente.', 'error');
                
                // Restaurar bot√£o
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = '‚ú® Cadastrar Participante';
                submitBtn.disabled = false;
            }
        });
        
        // Realizar sorteio
        sortearBtn.addEventListener('click', function() {
            if (participants.length === 0) return;
            
            // Anima√ß√£o de sorteio
            sortearBtn.textContent = 'üé≤ Sorteando...';
            sortearBtn.disabled = true;
            
            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * participants.length);
                const winner = participants[randomIndex];
                
                winnerInfo.innerHTML = `
                    <div class="text-2xl font-bold text-orange-600 mb-2">üéâ ${winner.name}</div>
                    <div class="text-gray-600">ID: ${winner.id}</div>
                    <div class="text-sm text-gray-500 mt-2">Sorteado em ${new Date().toLocaleString('pt-BR')}</div>
                `;
                
                sorteioResult.classList.remove('hidden');
                sorteioResult.classList.add('fade-in');
                
                sortearBtn.textContent = 'üé≤ Realizar Novo Sorteio';
                sortearBtn.disabled = false;
            }, 2000);
        });
        
        // Limpar lista
        clearListBtn.addEventListener('click', async function() {
            if (confirm('Tem certeza que deseja limpar toda a lista de participantes?')) {
                try {
                    // Mostrar loading
                    clearListBtn.textContent = '‚è≥ Limpando...';
                    clearListBtn.disabled = true;
                    
                    // Remover todos os participantes do Firebase
                    await remove(participantsRef);
                    
                    sorteioResult.classList.add('hidden');
                    showMessage('üóëÔ∏è Lista de participantes foi limpa!', 'info');
                    
                    // Restaurar bot√£o
                    clearListBtn.textContent = 'üóëÔ∏è Limpar Lista';
                    clearListBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Erro ao limpar lista:', error);
                    showMessage('‚ùå Erro ao limpar lista. Tente novamente.', 'error');
                    
                    // Restaurar bot√£o
                    clearListBtn.textContent = 'üóëÔ∏è Limpar Lista';
                    clearListBtn.disabled = false;
                }
            }
        });
        
        // Fun√ß√µes auxiliares
        function showMessage(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `mt-4 p-4 rounded-lg ${getMessageClass(type)}`;
            statusMessage.classList.remove('hidden');
            
            setTimeout(() => {
                statusMessage.classList.add('hidden');
            }, 5000);
        }
        
        function getMessageClass(type) {
            switch(type) {
                case 'success': return 'bg-green-100 text-green-800 border border-green-300';
                case 'error': return 'bg-red-100 text-red-800 border border-red-300';
                case 'info': return 'bg-blue-100 text-blue-800 border border-blue-300';
                default: return 'bg-gray-100 text-gray-800 border border-gray-300';
            }
        }
        
        function updateDisplay() {
            // S√≥ atualizar se estiver logado como admin
            if (isAdminLoggedIn) {
                // Atualizar contador
                totalParticipants.textContent = participants.length;
                
                // Habilitar/desabilitar bot√£o de sorteio
                sortearBtn.disabled = participants.length === 0;
                
                // Atualizar lista de participantes (s√≥ para admin)
                if (participants.length === 0) {
                    participantsList.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum participante cadastrado ainda.</p>';
                } else {
                    participantsList.innerHTML = participants.map((participant, index) => `
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold">
                                    ${index + 1}
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-800">${participant.name}</div>
                                    <div class="text-sm text-gray-500">ID: ${participant.id}</div>
                                </div>
                            </div>
                            <div class="text-xs text-gray-400">
                                ${participant.timestamp}
                            </div>
                        </div>
                    `).join('');
                }
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98b0a1a05245275b',t:'MTc1OTg3NDAwNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
